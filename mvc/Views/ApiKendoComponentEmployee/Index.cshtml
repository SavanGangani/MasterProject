@model List<tblEmployee>

@{
    ViewBag.Title = "Employee List";
}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js"
    integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<h2>Employee List</h2>

<p>
    @Html.ActionLink("Add Employee", "Add", "ApiKendoComponentEmployee", null, new { @class = "btn btn-primary" })
    <button class="btn btn-primary" onclick="logout()">Logout</button>
</p>

<div class="table-responsive">
    <table class="table table-striped table-bordered" id="empTable">
        <thead class="thead-dark">
            <tr>
                <th>#</th>
                <th>Name</th>
                <th>Gender</th>
                <th>Date of Birth</th>
                <th>Shift</th>
                <th>Image</th>
                <th>Department</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
           
        </tbody>
    </table>
</div>
@* <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script> *@

@section Scripts {
    <script>
        $(document).ready(function () {
            // Load employees data on page load
            loadEmployees();
            });
            
            function loadEmployees() {
                $.ajax({
                    url: 'https://localhost:7044/api/EmployeeApi',
                    method: 'GET',
                    success: function (data) {
                    var empTable = $('#empTable tbody');
                    empTable.empty();
                    data.forEach((emp) => {
                        const row = `<tr>
                                                                    <td>${emp.c_empid}</td>
                                                                    <td>${emp.c_empname}</td>
                                                                    <td>${emp.c_empgender}</td>
                                                                    <td>${emp.c_empdob}</td>
                                                                    <td>${emp.c_empshift}</td>
        @* <img src="@Url.Content("~/uploads/" + emp.c_empimg)" alt="Employee Photo"  style="width: 100px; height: 100px;" /> *@
                                                                    <td>
                                                                         <img src='/uploads/${emp.c_empimg}' alt="Employee Photo" style="width: 100px; height: 100px;" />
                                                                    </td>
                                                                    <td>${emp.department}</td>
                                                                    <td>
                                                                        @* <button data-id="${emp.department}" class="btn btn-primary details">Details</button> *@
        @* @if (role == "Admin") *@
        @* { *@
                                                                                @* <button data-id="${emp.c_empid}" class="btn btn-secondary edit">Edit</button>
                                                                            <button data-id="${emp.c_empid}" class="btn btn-danger delete">Delete</button> *@
                                                                        <button class="btn btn-danger btn-sm" onclick="deleteEmployee(${emp.c_empid})">Delete</button>
                                <a href="/ApiKendoComponentEmployee/Edit/${emp.c_empid}" class="btn btn-primary btn-sm">Edit</a>
        @* } *@
                                                                    </td>
                                                                </tr>`;
                        empTable.append(row);
                    });
                },
                    error: function (xhr, status, error) {
                        console.error("Error loading employees:", error);
                    }
                });
            }

            function displayEmployees(data) {
                var $tbody = $('#empTable tbody');
                $tbody.empty();

                $.each(data, function (index, emp) {
                    $tbody.append(`
                        <tr>
                            <td>${emp.c_empid}</td>
                            <td>${emp.c_empname}</td>
                            <td>${emp.c_empgender}</td>
                            <td>${emp.c_empdob}</td>
                            <td>${emp.c_empshift}</td>
                            <td><img src="/images/${emp.c_empimg}" width="100" alt="${emp.c_empimg}"></td>
                            <td>${emp.c_empdepartment}</td>
                            <td>
                                <button class="btn btn-danger btn-sm" onclick="deleteEmployee(${emp.c_empid})">Delete</button>
                                <a href="/ApiKendoComponentEmployee/Edit/${emp.c_empid}" class="btn btn-primary btn-sm">Edit</a>
                            </td>
                        </tr>
                    `);
                });
            }

            function deleteEmployee(id) {
                if (confirm("Are you sure you want to delete this employee?")) {
                    $.ajax({
                        url: `https://localhost:7044/api/EmployeeApi/${id}`,
                        method: 'DELETE',
                        success: function (response) {
                            // Reload page after successful deletion
                            window.location.reload();
                        },
                        error: function (xhr, status, error) {
                            console.error("Error deleting employee:", error);
                        }
                    });
                }
            }

            function logout() {
                // Redirect to logout page
                window.location.href = '/ApiKendoComponentUser/Login';
            }
    </script>
}
